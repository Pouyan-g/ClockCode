<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Fancy Dashboard with Wi-Fi Connector</title>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
        font-family: Arial, sans-serif;
      }

      body {
        background-color: #000;
        color: #fff;
        padding: 20px;
        transition: background-color 0.5s ease;
      }

      h1 {
        color: #f0f0f0;
        text-align: left;
        font-size: 2.5rem;
        margin-bottom: 20px;
        animation: fadeIn 1s ease-out;
      }

      .wrapper {
        display: flex;
        flex-direction: column;
      }

      .header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 20px 30px;
        background-color: #111;
        position: sticky;
        top: 0;
        z-index: 100;
      }

      .header h1 {
        font-size: 2.5em;
        margin: 0;
      }

      .user-info {
        padding: 10px 20px;
        background-color: #444;
        border-radius: 30px;
        cursor: pointer;
        transition: transform 0.3s ease, background-color 0.3s ease;
      }

      .user-info:hover {
        transform: translateY(-5px);
        background-color: #555;
      }

      .content {
        padding: 30px;
        background-color: #1a1a1a;
        flex: 1;
      }

      .cards {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
        gap: 30px;
      }

      .card {
        background-color: #222;
        padding: 30px;
        border-radius: 10px;
        box-shadow: 0 4px 10px rgba(0, 0, 0, 0.5);
        transition: transform 0.3s ease, background-color 0.3s ease;
        display: flex;
        flex-direction: column;
        justify-content: space-between;
      }

      .card:hover {
        transform: translateY(-10px);
        background-color: #333;
      }

      .card h3 {
        font-size: 1.8em;
        margin-bottom: 15px;
      }

      .card p {
        font-size: 1.2em;
        color: #ccc;
      }

      /* Wi-Fi form styles in Card 1 */
      .wifi-card {
        background-color: #333;
        padding: 20px;
        border-radius: 10px;
        box-shadow: 0 4px 10px rgba(0, 0, 0, 0.3);
        transition: transform 0.3s ease, background-color 0.3s ease;
      }

      .wifi-card:hover {
        transform: translateY(-5px);
        background-color: #444;
      }

      button {
        background-color: #007bff;
        color: #fff;
        border: none;
        padding: 10px 20px;
        border-radius: 5px;
        cursor: pointer;
        font-size: 1.1rem;
        transition: background-color 0.3s ease;
      }

      button:hover {
        background-color: #0056b3;
      }

      .form-group {
        margin-bottom: 20px;
      }

      .form-group label {
        display: block;
        margin-bottom: 5px;
        font-weight: bold;
        color: #f0f0f0;
        font-size: 1.1rem;
      }

      .form-group input {
        width: 100%;
        padding: 10px;
        border: 1px solid #ccc;
        border-radius: 5px;
        font-size: 1rem;
        box-sizing: border-box;
        transition: transform 0.3s ease;
      }

      .form-group input:focus {
        outline: none;
        border-color: #007bff;
      }

      .error-message {
        color: red;
        font-size: 14px;
        margin-top: 10px;
        display: none;
      }

      .loading {
        display: none;
        margin-top: 20px;
        text-align: center;
      }

      .loading-spinner {
        border: 4px solid #f3f3f3;
        border-top: 4px solid #3498db;
        border-radius: 50%;
        width: 30px;
        height: 30px;
        animation: spin 1s linear infinite;
        margin: 0 auto;
      }

      @keyframes spin {
        0% {
          transform: rotate(0deg);
        }
        100% {
          transform: rotate(360deg);
        }
      }

      /* Animation for page elements */
      @keyframes fadeIn {
        0% {
          opacity: 0;
          transform: translateY(-30px);
        }
        100% {
          opacity: 1;
          transform: translateY(0);
        }
      }

      @keyframes slideIn {
        0% {
          opacity: 0;
          transform: translateY(10px);
        }
        100% {
          opacity: 1;
          transform: translateY(0);
        }
      }

      @media screen and (max-width: 768px) {
        .header {
          flex-direction: column;
          text-align: center;
        }

        .header h1 {
          font-size: 2em;
        }

        .user-info {
          margin-top: 15px;
        }

        .cards {
          grid-template-columns: 1fr;
        }

        .content {
          padding: 20px;
        }
      }

      @media screen and (max-width: 480px) {
        .header h1 {
          font-size: 1.8em;
        }

        .user-info {
          font-size: 1em;
          padding: 8px 16px;
        }

        .card {
          padding: 20px;
        }

        .card h3 {
          font-size: 1.5em;
        }

        .card p {
          font-size: 1em;
        }
      }
    </style>
  </head>
  <body>
    <div class="wrapper">
      <header class="header">
        <h1>Dashboard</h1>
        <div class="user-info">
          <span>User</span>
        </div>
      </header>

      <main class="content">
        <section class="cards">
          <!-- Card 1: Wi-Fi Connector -->
          <div class="card wifi-card larger">
            <h3>Connect to Wi-Fi</h3>
            <button onclick="scanNetworks()">Scan Networks</button>
            <ul id="network-list"></ul>
          </div>

          <!-- Card 2: Update Wi-Fi Credentials -->
          <div class="card">
            <h3>Update Wi-Fi Credentials</h3>
            <form id="credentialsForm">
              <div class="form-group">
                <label for="ssid">New SSID:</label>
                <input type="text" id="ssid" name="ssid" placeholder="Enter new SSID" required />
              </div>
              <div class="form-group">
                <label for="password">New Password:</label>
                <input
                  type="password"
                  id="password"
                  name="password"
                  placeholder="Enter new password (min 8 characters)"
                  required
                  minlength="8"
                />
                <div class="error-message" id="passwordError">
                  Password must be at least 8 characters long.
                </div>
              </div>
              <button type="submit">Update</button>
            </form>
            <div class="loading" id="loading">
              <div class="loading-spinner"></div>
              <p>Updating credentials. Device will reset shortly...</p>
            </div>
          </div>

          <!-- Other cards -->
          <div class="card">
            <h3>Card 3</h3>
            <p>Some data or content here...</p>
          </div>
          <div class="card larger">
            <h3>Card 4</h3>
            <p>More content or data goes here...</p>
          </div>
        </section>
      </main>
    </div>

    <script>
      // Wi-Fi Connector Functions
      let currentOpen = null;

      function scanNetworks() {
        fetch("/scan")
          .then((response) => response.json())
          .then((data) => {
            const networkList = document.getElementById("network-list");
            networkList.innerHTML = ""; // Clear previous results
            data.forEach((network) => {
              const li = document.createElement("li");
              const networkItem = document.createElement("div");
              networkItem.classList.add("network-item");
              networkItem.innerHTML = `${network.ssid}`;

              const signalInfo = document.createElement("span");
              signalInfo.classList.add("signal-info");
              signalInfo.innerHTML = `(Signal: ${network.rssi} dBm)`;

              const passwordForm = document.createElement("div");
              passwordForm.classList.add("password-form");
              passwordForm.innerHTML = `
                <div class="form-group">
                  <label for="password-${network.ssid}">Password:</label>
                  <input type="password" id="password-${network.ssid}" />
                </div>
                <button onclick="connectToNetwork('${network.ssid}')">Connect</button>
              `;

              networkItem.appendChild(signalInfo);
              li.appendChild(networkItem);
              li.appendChild(passwordForm);
              li.onclick = (event) =>
                togglePasswordForm(event, network.ssid, li);

              networkList.appendChild(li);
            });
          })
          .catch((error) => console.error("Error fetching networks:", error));
      }

      function togglePasswordForm(event, ssid, li) {
        event.stopPropagation();
        const passwordForm = li.querySelector(".password-form");

        if (passwordForm.style.display === "block") {
          return;
        }

        if (currentOpen && currentOpen !== passwordForm) {
          currentOpen.style.display = "none";
        }

        passwordForm.style.display = "block";
        currentOpen = passwordForm;
      }

      function connectToNetwork(ssid) {
        const password = document.getElementById(`password-${ssid}`).value;

        fetch(
          "/connect?ssid=" +
            encodeURIComponent(ssid) +
            "&password=" +
            encodeURIComponent(password)
        )
          .then((response) => response.text())
          .then((message) => {
            alert(message);
          })
          .catch((error) =>
            console.error("Error connecting to network:", error)
          );
      }

      // Update Wi-Fi Credentials Form
      document.getElementById("credentialsForm").addEventListener("submit", function (event) {
        event.preventDefault();

        const password = document.getElementById("password").value;
        if (password.length < 8) {
          document.getElementById("passwordError").style.display = "block";
          return;
        } else {
          document.getElementById("passwordError").style.display = "none";
        }

        const confirmed = confirm("Are you sure you want to update the Wi-Fi credentials? The device will reset after updating.");
        if (!confirmed) return;

        document.getElementById("loading").style.display = "block";

        const ssid = document.getElementById("ssid").value;

        fetch("/update", {
          method: "POST",
          headers: {
            "Content-Type": "application/x-www-form-urlencoded",
          },
          body: `ssid=${encodeURIComponent(ssid)}&password=${encodeURIComponent(password)}`,
        })
          .then((response) => response.text())
          .then((data) => {
            alert(data);
            document.getElementById("loading").style.display = "none";
          })
          .catch((error) => {
            console.error("Error:", error);
            alert("Failed to update credentials. Please try again.");
            document.getElementById("loading").style.display = "none";
          });
      });
    </script>
  </body>
</html>